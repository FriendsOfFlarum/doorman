module.exports=function(o){var e={};function t(a){if(e[a])return e[a].exports;var r=e[a]={i:a,l:!1,exports:{}};return o[a].call(r.exports,r,r.exports,t),r.l=!0,r.exports}return t.m=o,t.c=e,t.d=function(o,e,a){t.o(o,e)||Object.defineProperty(o,e,{enumerable:!0,get:a})},t.r=function(o){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(o,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(o,"__esModule",{value:!0})},t.t=function(o,e){if(1&e&&(o=t(o)),8&e)return o;if(4&e&&"object"==typeof o&&o&&o.__esModule)return o;var a=Object.create(null);if(t.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:o}),2&e&&"string"!=typeof o)for(var r in o)t.d(a,r,function(e){return o[e]}.bind(null,r));return a},t.n=function(o){var e=o&&o.__esModule?function(){return o.default}:function(){return o};return t.d(e,"a",e),e},t.o=function(o,e){return Object.prototype.hasOwnProperty.call(o,e)},t.p="",t(t.s=16)}([function(o,e){o.exports=flarum.core.compat.app},function(o,e){o.exports=flarum.core.compat.Model},function(o,e){o.exports=flarum.core.compat.extend},function(o,e){o.exports=flarum.core.compat["components/Switch"]},function(o,e){o.exports=flarum.core.compat["components/Button"]},function(o,e){o.exports=flarum.core.compat["components/Select"]},,function(o,e){o.exports=flarum.core.compat["components/LoadingIndicator"]},function(o,e){o.exports=flarum.core.compat["components/AdminNav"]},function(o,e){o.exports=flarum.core.compat["components/AdminLinkButton"]},function(o,e){o.exports=flarum.core.compat["components/Page"]},function(o,e){o.exports=flarum.core.compat.Component},function(o,e){o.exports=flarum.core.compat["components/Badge"]},function(o,e){o.exports=flarum.core.compat["utils/saveSettings"]},function(o,e){o.exports=flarum.core.compat["utils/mixin"]},function(o,e){o.exports=flarum.core.compat["models/forum"]},function(o,e,t){"use strict";t.r(e);var a=t(0),r=t.n(a),n=(t(15),t(2)),s=t(8),i=t.n(s),l=t(9),c=t.n(l);function u(o,e){o.prototype=Object.create(e.prototype),o.prototype.constructor=o,o.__proto__=e}var d=t(10),p=t.n(d),y=t(7),f=t.n(y),h=t(11),k=t.n(h),g=t(4),v=t.n(g),x=t(12),b=t.n(x),w=t(5),N=t.n(w),D=t(3),I=t.n(D),O=function(o){function e(){return o.apply(this,arguments)||this}u(e,o);var t=e.prototype;return t.view=function(){return this.doorkey=this.props.doorkey,this.doorkeys=this.props.doorkeys,m("div",{style:"float: left;"},m("input",{className:"FormControl Doorkey-key",type:"text",value:this.doorkey.key(),placeholder:app.translator.trans("reflar-doorman.admin.page.doorkey.key"),onchange:m.withAttr("value",this.updateKey.bind(this,this.doorkey))}),N.a.component({options:this.getGroupsForInput(),className:"Doorkey-select",onchange:this.updateGroupId.bind(this,this.doorkey),value:this.doorkey.groupId()||3}),m("input",{className:"FormControl Doorkey-maxUses",value:this.doorkey.maxUses()||"0",type:"number",placeholder:app.translator.trans("reflar-doorman.admin.page.doorkey.max_uses"),onchange:m.withAttr("value",this.updateMaxUses.bind(this,this.doorkey))}),I.a.component({state:this.doorkey.activates()||!1,onchange:this.updateActivates.bind(this,this.doorkey),className:"Doorkey-switch"}),v.a.component({type:"button",className:"Button Button--warning Doorkey-button",icon:"fa fa-times",onclick:this.deleteDoorkey.bind(this,this.doorkey)}),this.doorkey.maxUses()===this.doorkey.uses()?b.a.component({className:"Doorkey-badge",icon:"fas fa-user-slash",label:app.translator.trans("reflar-doorman.admin.page.doorkey.warning")}):"")},t.config=function(o){o||$(".fa-exclamation-cricle").tooltip({container:"body"})},t.getGroupsForInput=function(){var o=[];return app.store.all("groups").map(function(e){"Guest"!==e.nameSingular()&&(o[e.id()]=e.nameSingular())}),o},t.updateKey=function(o,e){o.save({key:e})},t.updateGroupId=function(o,e){o.save({groupId:e})},t.updateMaxUses=function(o,e){o.save({maxUses:e})},t.updateActivates=function(o,e){o.save({activates:e})},t.deleteDoorkey=function(o){var e=this;o.delete(),this.doorkeys.some(function(t,a){if(t.data.id===o.data.id)return e.doorkeys.splice(a,1),!0})},e}(k.a),S=t(13),U=t.n(S),_=function(o){function e(){return o.apply(this,arguments)||this}u(e,o);var t=e.prototype;return t.init=function(){o.prototype.init.call(this),this.loading=!1,this.switcherLoading=!1,this.doorkeys=r.a.store.all("doorkeys"),this.isOptional=r.a.data.settings["reflar.doorman.allowPublic"],this.doorkey={key:m.prop(this.generateRandomKey()),groupId:m.prop(3),maxUses:m.prop(10),activates:m.prop(!1)}},t.view=function(){var o=this;return m("div",{className:"container Doorkey-container"},m("h1",null,"Doorman"),this.loading?m(f.a,null):"",m("div",{className:"Doorkeys-title"},m("h2",null,r.a.translator.trans("reflar-doorman.admin.page.doorkey.title")),m("div",{className:"helpText"},r.a.translator.trans("reflar-doorman.admin.page.doorkey.help.key")),m("div",{className:"helpText"},r.a.translator.trans("reflar-doorman.admin.page.doorkey.help.group")),m("div",{className:"helpText"},r.a.translator.trans("reflar-doorman.admin.page.doorkey.help.max")),m("div",{className:"helpText"},r.a.translator.trans("reflar-doorman.admin.page.doorkey.help.activates"))),m("div",null,m("h3",{className:"key"},r.a.translator.trans("reflar-doorman.admin.page.doorkey.heading.key")),m("h3",{className:"group"},r.a.translator.trans("reflar-doorman.admin.page.doorkey.heading.group")),m("h3",{className:"maxUses"},r.a.translator.trans("reflar-doorman.admin.page.doorkey.heading.max_uses")),m("h3",{className:"activate"},r.a.translator.trans("reflar-doorman.admin.page.doorkey.heading.activate"))),m("div",{className:"Doorkeys"},this.doorkeys.map(function(e){return O.component({doorkey:e,doorkeys:o.doorkeys})})),m("div",{className:"Doorkeys-new"},m("input",{className:"FormControl Doorkey-key",type:"text",value:this.doorkey.key(),placeholder:r.a.translator.trans("reflar-doorman.admin.page.doorkey.key"),oninput:m.withAttr("value",this.doorkey.key)}),N.a.component({options:this.getGroupsForInput(),className:"Doorkey-select",onchange:this.doorkey.groupId,value:this.doorkey.groupId()}),m("input",{className:"FormControl Doorkey-maxUses",value:this.doorkey.maxUses(),type:"number",placeholder:r.a.translator.trans("reflar-doorman.admin.page.doorkey.max_uses"),oninput:m.withAttr("value",this.doorkey.maxUses)}),I.a.component({state:this.doorkey.activates()||!1,onchange:this.doorkey.activates,className:"Doorkey-switch"}),v.a.component({type:"button",className:"Button Button--warning Doorkey-button",icon:"fa fa-plus",onclick:this.createDoorkey.bind(this)})),m("div",{className:"Doorkey-allowPublic"},m("h2",null,r.a.translator.trans("reflar-doorman.admin.page.doorkey.allow-public.title")),this.switcherLoading?m(f.a,null):m(I.a,{state:this.isOptional,onchange:this.toggleOptional.bind(this),className:"AllowPublic-switch"},r.a.translator.trans("reflar-doorman.admin.page.doorkey.allow-public.switch-label"))))},t.getGroupsForInput=function(){var o=[];return r.a.store.all("groups").map(function(e){"Guest"!==e.nameSingular()&&(o[e.id()]=e.nameSingular())}),o},t.generateRandomKey=function(){return Array(9).join((Math.random().toString(36)+"00000000000000000").slice(2,18)).slice(0,8)},t.createDoorkey=function(o){var e=this;r.a.store.createRecord("doorkeys").save({key:this.doorkey.key(),groupId:this.doorkey.groupId(),maxUses:this.doorkey.maxUses(),activates:this.doorkey.activates()}).then(function(o){e.doorkey.key(e.generateRandomKey()),e.doorkey.groupId(3),e.doorkey.maxUses(10),e.doorkey.activates(""),e.doorkeys.push(o),m.redraw()})},t.toggleOptional=function(){var o=this;this.switcherLoading=!0;var e={"reflar.doorman.allowPublic":JSON.stringify(!this.isOptional)};U()(e).then(function(){o.isOptional=JSON.parse(r.a.data.settings["reflar.doorman.allowPublic"])}).catch(function(){}).then(function(){o.switcherLoading=!1,m.redraw()})},e}(p.a),P=t(1),j=t.n(P),A=t(14),F=function(o){function e(){return o.apply(this,arguments)||this}return u(e,o),e.prototype.apiEndpoint=function(){return"/reflar/doorkeys"+(this.exists?"/"+this.data.id:"")},e}(t.n(A)()(j.a,{id:j.a.attribute("id"),key:j.a.attribute("key"),groupId:j.a.attribute("groupId"),maxUses:j.a.attribute("maxUses"),uses:j.a.attribute("uses"),activates:j.a.attribute("activates")}));r.a.initializers.add("reflar-doorman",function(){r.a.store.models.doorkeys=F,app.routes["reflar-doorman"]={path:"/reflar/doorman",component:_.component()},app.extensionSettings["reflar-doorman"]=function(){return m.route(app.route("reflar-doorman"))},Object(n.extend)(i.a.prototype,"items",function(o){o.add("reflar-doorman",c.a.component({href:app.route("reflar-doorman"),icon:"fa fa-door-closed",children:"Doorman",description:app.translator.trans("reflar-doorman.admin.nav.desc")}))})})}]);
//# sourceMappingURL=admin.js.map