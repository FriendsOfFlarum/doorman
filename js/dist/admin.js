module.exports=function(o){var a={};function e(t){if(a[t])return a[t].exports;var r=a[t]={i:t,l:!1,exports:{}};return o[t].call(r.exports,r,r.exports,e),r.l=!0,r.exports}return e.m=o,e.c=a,e.d=function(o,a,t){e.o(o,a)||Object.defineProperty(o,a,{enumerable:!0,get:t})},e.r=function(o){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(o,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(o,"__esModule",{value:!0})},e.t=function(o,a){if(1&a&&(o=e(o)),8&a)return o;if(4&a&&"object"==typeof o&&o&&o.__esModule)return o;var t=Object.create(null);if(e.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:o}),2&a&&"string"!=typeof o)for(var r in o)e.d(t,r,function(a){return o[a]}.bind(null,r));return t},e.n=function(o){var a=o&&o.__esModule?function(){return o.default}:function(){return o};return e.d(a,"a",a),a},e.o=function(o,a){return Object.prototype.hasOwnProperty.call(o,a)},e.p="",e(e.s=18)}([function(o,a){o.exports=flarum.core.compat.app},function(o,a){o.exports=flarum.core.compat["components/Button"]},function(o,a){o.exports=flarum.core.compat.Model},function(o,a){o.exports=flarum.core.compat.extend},function(o,a){o.exports=flarum.core.compat["components/Switch"]},function(o,a){o.exports=flarum.core.compat["components/Select"]},,function(o,a){o.exports=flarum.core.compat["components/Alert"]},function(o,a){o.exports=flarum.core.compat["components/LoadingIndicator"]},function(o,a){o.exports=flarum.core.compat["components/AdminNav"]},function(o,a){o.exports=flarum.core.compat["components/AdminLinkButton"]},function(o,a){o.exports=flarum.core.compat["components/Page"]},function(o,a){o.exports=flarum.core.compat.Component},function(o,a){o.exports=flarum.core.compat["components/Badge"]},function(o,a){o.exports=flarum.core.compat["components/Modal"]},function(o,a){o.exports=flarum.core.compat["utils/saveSettings"]},function(o,a){o.exports=flarum.core.compat["utils/mixin"]},function(o,a){o.exports=flarum.core.compat["models/forum"]},function(o,a,e){"use strict";e.r(a);var t=e(0),r=e.n(t),n=(e(17),e(3)),s=e(9),i=e.n(s),l=e(10),d=e.n(l);function c(o,a){o.prototype=Object.create(a.prototype),o.prototype.constructor=o,o.__proto__=a}var p=e(11),u=e.n(p),f=e(8),h=e.n(f),y=e(12),k=e.n(y),g=e(1),v=e.n(g),b=e(13),x=e.n(b),w=e(5),N=e.n(w),D=e(4),I=e.n(D),S=e(7),U=e.n(S),O=e(14),_=function(o){function a(){return o.apply(this,arguments)||this}c(a,o);var e=a.prototype;return e.init=function(){o.prototype.init.call(this),this.emails=[],this.doorkey=this.props.doorkey,this.success=!1},e.className=function(){return"InviteCodeModal Modal--small"},e.title=function(){return app.translator.trans("reflar-doorman.admin.modal.title")},e.config=function(){var o=this;$("#EmailInput").off().on("keydown",function(a){13!==a.keyCode&&188!==a.keyCode&&32!==a.keyCode||(a.preventDefault(),o.addEmails())})},e.content=function(){var o=this;return m("div",{className:"Modal-body"},m("h3",null,app.translator.trans("reflar-doorman.admin.modal.group",{group:app.store.getById("groups",this.doorkey.groupId()).nameSingular()})),m("div",{className:"helpText"},app.translator.trans("reflar-doorman.admin.modal.help")),m("div",{className:"Form Form--centered"},m("div",{className:"Form-group"},m("input",{type:"text",name:"text",id:"EmailInput",className:"FormControl",placeholder:app.translator.trans("reflar-doorman.admin.modal.placeholder"),disabled:this.loading})),m("div",{className:"Form-group"},m("ul",null,this.emails.map(function(a,e){return m("li",{className:"emailListItem"},m("p",null,a),v.a.component({className:"Button",loading:o.loading,icon:"fas fa-times",onclick:o.removeEmail.bind(o,e)}))}))),m("div",{className:"Form-group"},v.a.component({className:"Button Button--primary Button--block",loading:this.loading,onclick:this.send.bind(this),disabled:0===this.emails.length,children:app.translator.trans("reflar-doorman.admin.modal.send")}))))},e.addEmails=function(){var o=this;this.alert=null,m.redraw(),this.badEmails=[],$("#EmailInput").val().split(/[ ,]+/).map(function(a){o.emails.includes(a)||(o.emails.length+1>o.doorkey.data.attributes.maxUses?(o.alert=new U.a({type:"error",children:app.translator.trans("reflar-doorman.admin.modal.max_use_conflict")}),m.redraw()):o.validateEmail(a)?(o.emails.push(a),$("#EmailInput").val(""),m.redraw()):(o.badEmails.push(a),o.alert=new U.a({type:"error",children:app.translator.trans("reflar-doorman.admin.modal.invalid_emails",{emails:o.badEmails.join(", ")})}),m.redraw()))})},e.validateEmail=function(o){return/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(String(o).toLowerCase())},e.removeEmail=function(o){this.emails.splice(o,1)},e.send=function(o){o.preventDefault(),this.alert=null,this.loading=!0,app.request({method:"POST",url:app.forum.attribute("apiUrl")+"/reflar/doorkeys/invites",data:{emails:this.emails,doorkeyId:this.doorkey.data.id}}).then(function(){app.modal.close(),app.alerts.show(new U.a({type:"success",children:app.translator.trans("reflar-doorman.admin.modal.success")}))})},a}(e.n(O).a),B=function(o){function a(){return o.apply(this,arguments)||this}c(a,o);var e=a.prototype;return e.view=function(){this.doorkey=this.props.doorkey,this.doorkeys=this.props.doorkeys;var o=this.doorkey.maxUses()-this.doorkey.uses();return m("div",{className:"DoormanSettingsListItem"},m("div",{className:"DoormanSettingsListItem-inputs"},m("input",{className:"FormControl Doorkey-key",type:"text",disabled:!0,value:this.doorkey.key(),placeholder:app.translator.trans("reflar-doorman.admin.page.doorkey.key"),onchange:m.withAttr("value",this.updateKey.bind(this,this.doorkey))}),N.a.component({options:this.getGroupsForInput(),className:"Doorkey-select",onchange:this.updateGroupId.bind(this,this.doorkey),value:this.doorkey.groupId()||3}),m("input",{className:"FormControl Doorkey-maxUses",value:this.doorkey.maxUses()||"0",type:"number",placeholder:app.translator.trans("reflar-doorman.admin.page.doorkey.max_uses"),onchange:m.withAttr("value",this.updateMaxUses.bind(this,this.doorkey))}),I.a.component({state:this.doorkey.activates()||!1,onchange:this.updateActivates.bind(this,this.doorkey),className:"Doorkey-switch"})),v.a.component({type:"button",className:"Button Button--warning Doorkey-button",icon:"fa fa-envelope",onclick:this.showModal.bind(this)}),v.a.component({type:"button",className:"Button Button--warning Doorkey-button",icon:"fa fa-times",onclick:this.deleteDoorkey.bind(this,this.doorkey)}),this.doorkey.maxUses()===this.doorkey.uses()?x.a.component({className:"Doorkey-badge",icon:"fas fa-user-slash",label:app.translator.trans("reflar-doorman.admin.page.doorkey.warning")}):0!==this.doorkey.uses()?m("div",null,m("h3",{className:"Doorkey-left"},app.translator.transChoice("reflar-doorman.admin.page.doorkey.used_times",o,{remaining:o}).join(""))):"")},e.showModal=function(){app.modal.show(new _({doorkey:this.doorkey}))},e.config=function(o){o||$(".fa-exclamation-cricle").tooltip({container:"body"})},e.getGroupsForInput=function(){var o=[];return app.store.all("groups").map(function(a){"Guest"!==a.nameSingular()&&(o[a.id()]=a.nameSingular())}),o},e.updateKey=function(o,a){o.save({key:a})},e.updateGroupId=function(o,a){o.save({groupId:a})},e.updateMaxUses=function(o,a){o.save({maxUses:a})},e.updateActivates=function(o,a){o.save({activates:a})},e.deleteDoorkey=function(o){var a=this;o.delete(),this.doorkeys.some(function(e,t){if(e.data.id===o.data.id)return a.doorkeys.splice(t,1),!0})},a}(k.a),E=e(15),F=e.n(E),M=function(o){function a(){return o.apply(this,arguments)||this}c(a,o);var e=a.prototype;return e.init=function(){o.prototype.init.call(this),this.loading=!1,this.switcherLoading=!1,this.doorkeys=r.a.store.all("doorkeys"),this.isOptional=r.a.data.settings["reflar.doorman.allowPublic"],this.doorkey={key:m.prop(this.generateRandomKey()),groupId:m.prop(3),maxUses:m.prop(10),activates:m.prop(!1)}},e.view=function(){var o=this;return m("div",{className:"container Doorkey-container"},m("h1",null,"Doorman"),this.loading?m(h.a,null):"",m("div",{className:"Doorkeys-title"},m("h2",null,r.a.translator.trans("reflar-doorman.admin.page.doorkey.title")),m("div",{className:"helpText"},r.a.translator.trans("reflar-doorman.admin.page.doorkey.help.key")),m("div",{className:"helpText"},r.a.translator.trans("reflar-doorman.admin.page.doorkey.help.group")),m("div",{className:"helpText"},r.a.translator.trans("reflar-doorman.admin.page.doorkey.help.max")),m("div",{className:"helpText"},r.a.translator.trans("reflar-doorman.admin.page.doorkey.help.activates"))),m("div",{className:"Doorkeys-fieldLabels"},m("h3",{className:"key"},r.a.translator.trans("reflar-doorman.admin.page.doorkey.heading.key")),m("h3",{className:"group"},r.a.translator.trans("reflar-doorman.admin.page.doorkey.heading.group")),m("h3",{className:"maxUses"},r.a.translator.trans("reflar-doorman.admin.page.doorkey.heading.max_uses")),m("h3",{className:"activate"},r.a.translator.trans("reflar-doorman.admin.page.doorkey.heading.activate"))),m("div",{className:"Doorkeys"},this.doorkeys.map(function(a){return B.component({doorkey:a,doorkeys:o.doorkeys})})),m("div",{className:"Doorkeys-new"},m("div",{className:"Doorkeys-newInputs"},m("input",{className:"FormControl Doorkey-key",type:"text",value:this.doorkey.key(),placeholder:r.a.translator.trans("reflar-doorman.admin.page.doorkey.key"),oninput:m.withAttr("value",this.doorkey.key)}),N.a.component({options:this.getGroupsForInput(),className:"Doorkey-select",onchange:this.doorkey.groupId,value:this.doorkey.groupId()}),m("input",{className:"FormControl Doorkey-maxUses",value:this.doorkey.maxUses(),type:"number",placeholder:r.a.translator.trans("reflar-doorman.admin.page.doorkey.max_uses"),oninput:m.withAttr("value",this.doorkey.maxUses)}),I.a.component({state:this.doorkey.activates()||!1,onchange:this.doorkey.activates,className:"Doorkey-switch"})),v.a.component({type:"button",className:"Button Button--warning Doorkey-button",icon:"fa fa-plus",onclick:this.createDoorkey.bind(this)})),m("div",{className:"Doorkey-allowPublic"},m("h2",null,r.a.translator.trans("reflar-doorman.admin.page.doorkey.allow-public.title")),this.switcherLoading?m(h.a,null):m(I.a,{state:this.isOptional,onchange:this.toggleOptional.bind(this),className:"AllowPublic-switch"},r.a.translator.trans("reflar-doorman.admin.page.doorkey.allow-public.switch-label"))))},e.getGroupsForInput=function(){var o=[];return r.a.store.all("groups").map(function(a){"Guest"!==a.nameSingular()&&(o[a.id()]=a.nameSingular())}),o},e.generateRandomKey=function(){return Array(9).join((Math.random().toString(36)+"00000000000000000").slice(2,18)).slice(0,8)},e.createDoorkey=function(){var o=this;r.a.store.createRecord("doorkeys").save({key:this.doorkey.key(),groupId:this.doorkey.groupId(),maxUses:this.doorkey.maxUses(),activates:this.doorkey.activates()}).then(function(a){o.doorkey.key(o.generateRandomKey()),o.doorkey.groupId(3),o.doorkey.maxUses(10),o.doorkey.activates(""),o.doorkeys.push(a),m.redraw()})},e.toggleOptional=function(){var o=this;this.switcherLoading=!0;var a={"reflar.doorman.allowPublic":JSON.stringify(!this.isOptional)};F()(a).then(function(){o.isOptional=JSON.parse(r.a.data.settings["reflar.doorman.allowPublic"])}).catch(function(){}).then(function(){o.switcherLoading=!1,m.redraw()})},a}(u.a),A=e(2),j=e.n(A),C=e(16),P=function(o){function a(){return o.apply(this,arguments)||this}return c(a,o),a.prototype.apiEndpoint=function(){return"/reflar/doorkeys"+(this.exists?"/"+this.data.id:"")},a}(e.n(C)()(j.a,{id:j.a.attribute("id"),key:j.a.attribute("key"),groupId:j.a.attribute("groupId"),maxUses:j.a.attribute("maxUses"),uses:j.a.attribute("uses"),activates:j.a.attribute("activates")}));r.a.initializers.add("reflar-doorman",function(){r.a.store.models.doorkeys=P,app.routes["reflar-doorman"]={path:"/reflar/doorman",component:M.component()},app.extensionSettings["reflar-doorman"]=function(){return m.route(app.route("reflar-doorman"))},Object(n.extend)(i.a.prototype,"items",function(o){o.add("reflar-doorman",d.a.component({href:app.route("reflar-doorman"),icon:"fa fa-door-closed",children:"Doorman",description:app.translator.trans("reflar-doorman.admin.nav.desc")}))})})}]);
//# sourceMappingURL=admin.js.map