/*! For license information please see admin.js.LICENSE.txt */
(()=>{var t={24:(t,o,e)=>{var a=e(735).default;function r(){"use strict";t.exports=r=function(){return e},t.exports.__esModule=!0,t.exports.default=t.exports;var o,e={},n=Object.prototype,i=n.hasOwnProperty,s=Object.defineProperty||function(t,o,e){t[o]=e.value},l="function"==typeof Symbol?Symbol:{},u=l.iterator||"@@iterator",c=l.asyncIterator||"@@asyncIterator",d=l.toStringTag||"@@toStringTag";function m(t,o,e){return Object.defineProperty(t,o,{value:e,enumerable:!0,configurable:!0,writable:!0}),t[o]}try{m({},"")}catch(o){m=function(t,o,e){return t[o]=e}}function f(t,o,e,a){var r=o&&o.prototype instanceof k?o:k,n=Object.create(r.prototype),i=new T(a||[]);return s(n,"_invoke",{value:B(t,e,i)}),n}function p(t,o,e){try{return{type:"normal",arg:t.call(o,e)}}catch(t){return{type:"throw",arg:t}}}e.wrap=f;var h="suspendedStart",g="suspendedYield",y="executing",v="completed",b={};function k(){}function _(){}function x(){}var N={};m(N,u,(function(){return this}));var P=Object.getPrototypeOf,w=P&&P(P(U([])));w&&w!==n&&i.call(w,u)&&(N=w);var L=x.prototype=k.prototype=Object.create(N);function D(t){["next","throw","return"].forEach((function(o){m(t,o,(function(t){return this._invoke(o,t)}))}))}function I(t,o){function e(r,n,s,l){var u=p(t[r],t,n);if("throw"!==u.type){var c=u.arg,d=c.value;return d&&"object"==a(d)&&i.call(d,"__await")?o.resolve(d.__await).then((function(t){e("next",t,s,l)}),(function(t){e("throw",t,s,l)})):o.resolve(d).then((function(t){c.value=t,s(c)}),(function(t){return e("throw",t,s,l)}))}l(u.arg)}var r;s(this,"_invoke",{value:function(t,a){function n(){return new o((function(o,r){e(t,a,o,r)}))}return r=r?r.then(n,n):n()}})}function B(t,e,a){var r=h;return function(n,i){if(r===y)throw Error("Generator is already running");if(r===v){if("throw"===n)throw i;return{value:o,done:!0}}for(a.method=n,a.arg=i;;){var s=a.delegate;if(s){var l=E(s,a);if(l){if(l===b)continue;return l}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if(r===h)throw r=v,a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);r=y;var u=p(t,e,a);if("normal"===u.type){if(r=a.done?v:g,u.arg===b)continue;return{value:u.arg,done:a.done}}"throw"===u.type&&(r=v,a.method="throw",a.arg=u.arg)}}}function E(t,e){var a=e.method,r=t.iterator[a];if(r===o)return e.delegate=null,"throw"===a&&t.iterator.return&&(e.method="return",e.arg=o,E(t,e),"throw"===e.method)||"return"!==a&&(e.method="throw",e.arg=new TypeError("The iterator does not provide a '"+a+"' method")),b;var n=p(r,t.iterator,e.arg);if("throw"===n.type)return e.method="throw",e.arg=n.arg,e.delegate=null,b;var i=n.arg;return i?i.done?(e[t.resultName]=i.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=o),e.delegate=null,b):i:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,b)}function S(t){var o={tryLoc:t[0]};1 in t&&(o.catchLoc=t[1]),2 in t&&(o.finallyLoc=t[2],o.afterLoc=t[3]),this.tryEntries.push(o)}function F(t){var o=t.completion||{};o.type="normal",delete o.arg,t.completion=o}function T(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(S,this),this.reset(!0)}function U(t){if(t||""===t){var e=t[u];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,n=function e(){for(;++r<t.length;)if(i.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=o,e.done=!0,e};return n.next=n}}throw new TypeError(a(t)+" is not iterable")}return _.prototype=x,s(L,"constructor",{value:x,configurable:!0}),s(x,"constructor",{value:_,configurable:!0}),_.displayName=m(x,d,"GeneratorFunction"),e.isGeneratorFunction=function(t){var o="function"==typeof t&&t.constructor;return!!o&&(o===_||"GeneratorFunction"===(o.displayName||o.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,x):(t.__proto__=x,m(t,d,"GeneratorFunction")),t.prototype=Object.create(L),t},e.awrap=function(t){return{__await:t}},D(I.prototype),m(I.prototype,c,(function(){return this})),e.AsyncIterator=I,e.async=function(t,o,a,r,n){void 0===n&&(n=Promise);var i=new I(f(t,o,a,r),n);return e.isGeneratorFunction(o)?i:i.next().then((function(t){return t.done?t.value:i.next()}))},D(L),m(L,d,"Generator"),m(L,u,(function(){return this})),m(L,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var o=Object(t),e=[];for(var a in o)e.push(a);return e.reverse(),function t(){for(;e.length;){var a=e.pop();if(a in o)return t.value=a,t.done=!1,t}return t.done=!0,t}},e.values=U,T.prototype={constructor:T,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=o,this.done=!1,this.delegate=null,this.method="next",this.arg=o,this.tryEntries.forEach(F),!t)for(var e in this)"t"===e.charAt(0)&&i.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=o)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function a(a,r){return s.type="throw",s.arg=t,e.next=a,r&&(e.method="next",e.arg=o),!!r}for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r],s=n.completion;if("root"===n.tryLoc)return a("end");if(n.tryLoc<=this.prev){var l=i.call(n,"catchLoc"),u=i.call(n,"finallyLoc");if(l&&u){if(this.prev<n.catchLoc)return a(n.catchLoc,!0);if(this.prev<n.finallyLoc)return a(n.finallyLoc)}else if(l){if(this.prev<n.catchLoc)return a(n.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<n.finallyLoc)return a(n.finallyLoc)}}}},abrupt:function(t,o){for(var e=this.tryEntries.length-1;e>=0;--e){var a=this.tryEntries[e];if(a.tryLoc<=this.prev&&i.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var r=a;break}}r&&("break"===t||"continue"===t)&&r.tryLoc<=o&&o<=r.finallyLoc&&(r=null);var n=r?r.completion:{};return n.type=t,n.arg=o,r?(this.method="next",this.next=r.finallyLoc,b):this.complete(n)},complete:function(t,o){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&o&&(this.next=o),b},finish:function(t){for(var o=this.tryEntries.length-1;o>=0;--o){var e=this.tryEntries[o];if(e.finallyLoc===t)return this.complete(e.completion,e.afterLoc),F(e),b}},catch:function(t){for(var o=this.tryEntries.length-1;o>=0;--o){var e=this.tryEntries[o];if(e.tryLoc===t){var a=e.completion;if("throw"===a.type){var r=a.arg;F(e)}return r}}throw Error("illegal catch attempt")},delegateYield:function(t,e,a){return this.delegate={iterator:U(t),resultName:e,nextLoc:a},"next"===this.method&&(this.arg=o),b}},e}t.exports=r,t.exports.__esModule=!0,t.exports.default=t.exports},183:(t,o,e)=>{var a=e(24)();t.exports=a;try{regeneratorRuntime=a}catch(t){"object"==typeof globalThis?globalThis.regeneratorRuntime=a:Function("r","regeneratorRuntime = r")(a)}},735:t=>{function o(e){return t.exports=o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t.exports.__esModule=!0,t.exports.default=t.exports,o(e)}t.exports=o,t.exports.__esModule=!0,t.exports.default=t.exports}},o={};function e(a){var r=o[a];if(void 0!==r)return r.exports;var n=o[a]={exports:{}};return t[a](n,n.exports,e),n.exports}e.n=t=>{var o=t&&t.__esModule?()=>t.default:()=>t;return e.d(o,{a:o}),o},e.d=(t,o)=>{for(var a in o)e.o(o,a)&&!e.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:o[a]})},e.o=(t,o)=>Object.prototype.hasOwnProperty.call(t,o),e.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var a={};(()=>{"use strict";e.r(a),e.d(a,{components:()=>tt,extend:()=>X});const t=flarum.core.compat["admin/app"];var o=e.n(t);function r(t,o,e,a,r,n,i){try{var s=t[n](i),l=s.value}catch(t){return void e(t)}s.done?o(l):Promise.resolve(l).then(a,r)}function n(t,o){return n=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,o){return t.__proto__=o,t},n(t,o)}function i(t,o){t.prototype=Object.create(o.prototype),t.prototype.constructor=t,n(t,o)}var s=e(183),l=e.n(s);const u=flarum.core.compat["admin/components/ExtensionPage"];var c=e.n(u);const d=flarum.core.compat["common/utils/throttleDebounce"],f=flarum.core.compat["common/components/LoadingIndicator"];var p=e.n(f);const h=flarum.core.compat["common/components/Button"];var g=e.n(h);const y=flarum.core.compat["common/utils/ItemList"];var v=e.n(y);const b=flarum.core.compat["common/utils/classList"];var k=e.n(b);const _=flarum.core.compat["common/utils/extractText"];var x=e.n(_);const N=flarum.core.compat["common/components/GroupBadge"];var P=e.n(N);const w=flarum.core.compat["common/models/Group"];var L=e.n(w);const D=flarum.core.compat["common/helpers/icon"];var I=e.n(D);const B=flarum.core.compat["common/components/Badge"];var E=e.n(B);const S=flarum.core.compat["common/components/Modal"];var F=e.n(S);const T=flarum.core.compat["common/utils/Stream"];var U=e.n(T);const O=flarum.core.compat["common/components/Switch"];var C=e.n(O);const M=flarum.core.compat["common/components/Select"];var j=e.n(M),A=function(t){function e(){for(var o,e=arguments.length,a=new Array(e),r=0;r<e;r++)a[r]=arguments[r];return(o=t.call.apply(t,[this].concat(a))||this).key=void 0,o.groupId=void 0,o.maxUses=void 0,o.activates=void 0,o.bulkAdd=void 0,o}i(e,t);var a=e.prototype;return a.oninit=function(o){t.prototype.oninit.call(this,o),this.key=U()(this.generateRandomKey()),this.groupId=U()(3),this.maxUses=U()(10),this.activates=U()(!1),this.bulkAdd=U()(!1)},a.className=function(){return"Modal--small CreateDoorkeyModal"},a.title=function(){return o().translator.trans("fof-doorman.admin.modals.create_doorkey.title")},a.content=function(){return m("div",{className:"Modal-body"},m("div",{className:"Form"},this.fields().toArray()))},a.fields=function(){var t=this,e=new(v());return e.add("key",m("div",{className:"Form-group"},m("label",null,o().translator.trans("fof-doorman.admin.modals.create_doorkey.key.label")),m("div",{className:"helpText"},o().translator.trans("fof-doorman.admin.modals.create_doorkey.key.help")),m("input",{className:"FormControl",name:"key",type:"text",bidi:this.key,disabled:this.loading})),100),e.add("group",m("div",{className:"Form-group"},m("label",null,o().translator.trans("fof-doorman.admin.modals.create_doorkey.group.label")),m("div",{className:"helpText"},o().translator.trans("fof-doorman.admin.modals.create_doorkey.group.help")),m(j(),{name:"groupId",options:this.getGroupsForInput(),value:String(this.groupId()),onchange:function(o){return t.groupId(Number(o))},disabled:this.loading})),80),e.add("maxUses",m("div",{className:"Form-group"},m("label",null,o().translator.trans("fof-doorman.admin.modals.create_doorkey.max_uses.label")),m("div",{className:"helpText"},o().translator.trans("fof-doorman.admin.modals.create_doorkey.max_uses.help")),m("input",{className:"FormControl",name:"maxUses",type:"number",bidi:this.maxUses,disabled:this.loading})),60),e.add("activates",m("div",{className:"Form-group"},m("label",null,o().translator.trans("fof-doorman.admin.modals.create_doorkey.activates_user.label")),m("div",{className:"helpText"},o().translator.trans("fof-doorman.admin.modals.create_doorkey.activates_user.help")),m(C(),{name:"activates",state:this.activates(),onchange:function(o){return t.activates(o)},disabled:this.loading},"‎"," ")),40),e.add("submit",m("div",{className:"Form-group"},m(g(),{className:"Button Button--primary Button--block",type:"submit",loading:this.loading},o().translator.trans("fof-doorman.admin.modals.create_doorkey.submit_button"))),0),e.add("submitAndAdd",m("div",{className:"Form-group"},m(g(),{className:"Button Button--block",onclick:function(){return t.bulkAdd(!0)&&t.onsubmit()},disabled:this.loading},o().translator.trans("fof-doorman.admin.modals.create_doorkey.submit_and_create_another_button"))),-20),e},a.onready=function(){this.$("[name=key]").trigger("select")},a.onsubmit=function(t){var e,a=this;void 0===t&&(t=null),null==(e=t)||e.preventDefault(),this.loading=!0,o().request({url:o().forum.attribute("apiUrl")+"/fof/doorkeys",method:"POST",body:{data:{attributes:this.submitData()}},errorHandler:this.onerror.bind(this)}).then((function(){a.bulkAdd()?a.resetData():a.hide()})).finally((function(){a.bulkAdd(!1),a.loaded()}))},a.getGroupsForInput=function(){var t={};return o().store.all("groups").map((function(o){var e=o;e.id()!==L().GUEST_ID&&(t[e.id()]=e.nameSingular())})),t},a.generateRandomKey=function(){return Array(9).join((Math.random().toString(36)+"00000000000000000").slice(2,18)).slice(0,8)},a.submitData=function(){return{key:this.key(),groupId:this.groupId(),maxUses:this.maxUses(),activates:this.activates()}},a.resetData=function(){this.key(this.generateRandomKey()),this.groupId(3),this.maxUses(10)},e}(F());const G=flarum.core.compat["common/components/Alert"];var R=e.n(G),q=function(t){function e(){return t.apply(this,arguments)||this}i(e,t);var a=e.prototype;return a.oninit=function(o){t.prototype.oninit.call(this,o),this.emails=[],this.doorkey=this.attrs.doorkey,this.success=!1},a.className=function(){return"InviteCodeModal Modal--small"},a.title=function(){return o().translator.trans("fof-doorman.admin.modals.send_invites.title")},a.oncreate=function(o){var e=this;t.prototype.oncreate.call(this,o),$("#EmailInput").off().on("keydown",(function(t){13!==t.keyCode&&188!==t.keyCode&&32!==t.keyCode||(t.preventDefault(),e.addEmails())}))},a.onremove=function(e){t.prototype.onremove.call(this,e),o().alerts.dismiss(this.alert)},a.content=function(){var t=this;return m("div",{className:"Modal-body"},m("h3",null,o().translator.trans("fof-doorman.admin.modals.send_invites.group",{group:o().store.getById("groups",this.doorkey.groupId()).nameSingular()})),m("div",{className:"helpText"},o().translator.trans("fof-doorman.admin.modals.send_invites.help")),m("div",{className:"Form Form--centered"},m("div",{className:"Form-group"},m("input",{type:"text",name:"text",id:"EmailInput",className:"FormControl",placeholder:o().translator.trans("fof-doorman.admin.modals.send_invites.placeholder"),disabled:this.loading})),m("div",{className:"Form-group"},m("ul",null,this.emails.map((function(o,e){return m("li",{className:"emailListItem"},m("p",null,o),g().component({className:"Button",loading:t.loading,icon:"fas fa-times",onclick:t.removeEmail.bind(t,e)}))})))),m("div",{className:"Form-group"},g().component({className:"Button Button--primary Button--block",loading:this.loading,onclick:this.send.bind(this),disabled:0===this.emails.length},o().translator.trans("fof-doorman.admin.modals.send_invites.send")))))},a.addEmails=function(){var t=this;o().alerts.dismiss(this.alert),m.redraw(),this.badEmails=[],$("#EmailInput").val().split(/[ ,]+/).map((function(e){if(!t.emails.includes(e)){var a=t.doorkey.maxUses(),r=t.doorkey.uses();a>0&&r+t.emails.length+1>a?(t.alert=o().alerts.show(R(),{type:"error"},o().translator.trans("fof-doorman.admin.modals.send_invites.max_use_conflict")),m.redraw()):t.validateEmail(e)?(t.emails.push(e),$("#EmailInput").val(""),m.redraw()):(t.badEmails.push(e),t.alert=o().alerts.show(R(),{type:"error"},o().translator.trans("fof-doorman.admin.modals.send_invites.invalid_emails",{emails:t.badEmails.join(", ")})),m.redraw())}}))},a.validateEmail=function(t){return/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(String(t).toLowerCase())},a.removeEmail=function(t){this.emails.splice(t,1)},a.send=function(t){var e=this;t.preventDefault(),o().alerts.dismiss(this.alert),this.loading=!0,o().request({method:"POST",url:o().forum.attribute("apiUrl")+"/fof/doorkeys/invites",body:{emails:this.emails,doorkeyId:this.doorkey.data.id}}).then((function(){o().modal.close(),e.alert=o().alerts.show(R(),{type:"success"},o().translator.trans("fof-doorman.admin.modals.send_invites.success"))}))},e}(F());const z=flarum.core.compat["common/app"];var K=e.n(z),H=function(t){function o(){for(var o,e=arguments.length,a=new Array(e),r=0;r<e;r++)a[r]=arguments[r];return(o=t.call.apply(t,[this].concat(a))||this).key=void 0,o.groupId=void 0,o.maxUses=void 0,o.activates=void 0,o}i(o,t);var e=o.prototype;return e.oninit=function(o){t.prototype.oninit.call(this,o);var e=this.attrs.doorkey;this.key=U()(e.key()||""),this.groupId=U()(e.groupId()||""),this.maxUses=U()(e.maxUses()),this.activates=U()(e.activates()||!1)},e.className=function(){return"Modal--small EditDoorkeyModal"},e.title=function(){return K().translator.trans("fof-doorman.admin.modals.edit_doorkey.title")},e.content=function(){return m("div",{className:"Modal-body"},m("div",{className:"Form"},this.fields().toArray()))},e.fields=function(){var t=this,o=new(v());return o.add("key",m("div",{className:"Form-group"},m("label",null,K().translator.trans("fof-doorman.admin.modals.edit_doorkey.key.label")),m("div",{className:"helpText"},K().translator.trans("fof-doorman.admin.modals.edit_doorkey.key.help")),m("input",{className:"FormControl",bidi:this.key,disabled:!0})),100),o.add("group",m("div",{className:"Form-group"},m("label",null,K().translator.trans("fof-doorman.admin.modals.create_doorkey.group.label")),m("div",{className:"helpText"},K().translator.trans("fof-doorman.admin.modals.create_doorkey.group.help")),m(j(),{name:"groupId",options:this.getGroupsForInput(),"aria-label":K().translator.trans("fof-doorman.admin.edit_doorkey_modal.group"),value:String(this.groupId()),onchange:function(o){return t.groupId(Number(o))},disabled:this.loading})),80),o.add("maxUses",m("div",{className:"Form-group"},m("label",null,K().translator.trans("fof-doorman.admin.modals.create_doorkey.max_uses.label")),m("div",{className:"helpText"},K().translator.trans("fof-doorman.admin.modals.create_doorkey.max_uses.help")),m("input",{className:"FormControl",name:"maxUses",type:"number","aria-label":K().translator.trans("fof-doorman.admin.edit_doorkey_modal.max_uses"),bidi:this.maxUses,disabled:this.loading})),60),o.add("activates",m("div",{className:"Form-group"},m("label",null,K().translator.trans("fof-doorman.admin.modals.create_doorkey.activates_user.label")),m("div",{className:"helpText"},K().translator.trans("fof-doorman.admin.modals.create_doorkey.activates_user.help")),m(C(),{name:"activates",state:this.activates(),onchange:function(o){return t.activates(o)},disabled:this.loading},"‎"," ")),40),o.add("submit",m("div",{className:"Form-group"},m(g(),{className:"Button Button--primary",type:"submit",loading:this.loading},K().translator.trans("fof-doorman.admin.modals.edit_doorkey.submit_button"))),-10),o},e.getGroupsForInput=function(){var t={};return K().store.all("groups").map((function(o){var e=o;e.id()!==L().GUEST_ID&&(t[e.id()]=e.nameSingular())})),t},e.data=function(){return{groupId:Number(this.groupId()),maxUses:Number(this.maxUses()),activates:this.activates()}},e.onsubmit=function(t){var o=this;t.preventDefault(),this.loading=!0,this.attrs.doorkey.save(this.data(),{errorHandler:this.onerror.bind(this)}).then(this.hide.bind(this)).catch((function(){o.loading=!1})).finally((function(){var t=o.attrs.doorkey.id();t&&K().store.find("fof/doorkeys",t)}))},o}(F()),Y=function(t){function e(){for(var e,a=arguments.length,r=new Array(a),n=0;n<a;n++)r[n]=arguments[n];return(e=t.call.apply(t,[this].concat(r))||this).query="",e.throttledSearch=(0,d.debounce)(250,(function(){return e.loadPage(0)})),e.numPerPage=50,e.pageNumber=0,e.loadingPageNumber=0,e.doorkeyCount=o().data.modelStatistics.doorkeys.total,e.loadingDelete={},e.pageData=void 0,e.moreData=!1,e.isLoadingPage=!1,e}i(e,t);var a=e.prototype;return a.getTotalPageCount=function(){return-1===this.doorkeyCount?0:Math.ceil(this.doorkeyCount/this.numPerPage)},a.oninit=function(o){t.prototype.oninit.call(this,o);var e=parseInt(m.route.param("page"));isNaN(e)||e<1?(this.setPageNumberInUrl(1),this.pageNumber=0):this.pageNumber=e-1,this.loadingPageNumber=this.pageNumber},a.content=function(){var t=this;if(void 0===this.pageData)return this.loadPage(this.pageNumber),m("section",{className:"DoorkeyListPage-grid DoorkeyListPage-grid--loading"},m(p(),{containerClassName:"LoadingIndicator--block",size:"large"}));var e=this.columns().toArray();return m("div",{className:"container"},m("div",{className:"DoorkeyListPage-header"},this.headerItems().toArray()),m("div",{className:"Doorkey-allowPublic"},this.buildSettingComponent({type:"boolean",setting:"fof-doorman.allowPublic",label:o().translator.trans("fof-doorman.admin.settings.optional_usage")}),this.submitButton()),m("section",{className:k()(["DoorkeyListPage-grid",this.isLoadingPage?"DoorkeyListPage-grid--loadingPage":"DoorkeyListPage-grid--loaded"]),style:{"--columns":e.length},role:"table","aria-rowcount":this.pageData.length+1,"aria-colcount":e.length,"aria-live":"polite","aria-busy":this.isLoadingPage?"true":"false"},e.map((function(t,o){return m("div",{className:"DoorkeyListPage-grid-header",role:"columnheader","aria-colindex":o+1,"aria-rowindex":1},t.name)})),this.pageData.map((function(t,a){return e.map((function(e,r){var n=e.content&&e.content(t);return m("div",{className:k()(["DoorkeyListPage-grid-rowItem",a%2>0&&"DoorkeyListPage-grid-rowItem--shaded"]),"data-doorkey-id":t.id(),"data-column-name":e.itemName,"aria-colindex":r+1,"aria-rowindex":a+2,role:"cell"},null!=n?n:o().translator.trans("fof-doorman.admin.list.content.invalid_column"))}))})),this.isLoadingPage&&m(p(),{size:"large"})),m("nav",{className:"DoorkeyListPage-gridPagination"},m(g(),{disabled:0===this.pageNumber,title:o().translator.trans("fof-doorman.admin.list.pagination.first_page_button"),onclick:this.goToPage.bind(this,1),icon:"fas fa-step-backward",className:"Button Button--icon DoorkeyListPage-firstPageBtn"}),m(g(),{disabled:0===this.pageNumber,title:o().translator.trans("fof-doorman.admin.list.pagination.back_button"),onclick:this.previousPage.bind(this),icon:"fas fa-chevron-left",className:"Button Button--icon DoorkeyListPage-backBtn"}),m("span",{className:"DoorkeyListPage-pageNumber"},o().translator.trans("fof-doorman.admin.list.pagination.page_counter",{current:m("input",{type:"text",inputmode:"numeric",pattern:"[0-9]*",value:this.loadingPageNumber+1,"aria-label":x()(o().translator.trans("fof-doorman.admin.list.pagination.go_to_page_textbox_a11y_label")),autocomplete:"off",className:"FormControl DoorkeyListPage-pageNumberInput",onchange:function(o){var e=o.target,a=parseInt(e.value);isNaN(a)?e.value=(t.pageNumber+1).toString():(a<1?a=1:a>t.getTotalPageCount()&&(a=t.getTotalPageCount()),e.value=a.toString(),t.goToPage(a))}}),currentNum:this.pageNumber+1,total:this.getTotalPageCount()})),m(g(),{disabled:!this.moreData,title:o().translator.trans("fof-doorman.admin.list.pagination.next_button"),onclick:this.nextPage.bind(this),icon:"fas fa-chevron-right",className:"Button Button--icon DoorkeyListPage-nextBtn"}),m(g(),{disabled:!this.moreData,title:o().translator.trans("fof-doorman.admin.list.pagination.last_page_button"),onclick:this.goToPage.bind(this,this.getTotalPageCount()),icon:"fas fa-step-forward",className:"Button Button--icon DoorkeyListPage-lastPageBtn"})))},a.headerItems=function(){var t=this,e=new(v());return e.add("search",m("div",{className:"Search-input"},m("input",{className:"FormControl SearchBar",type:"search",placeholder:o().translator.trans("fof-doorman.admin.settings.search"),oninput:function(o){var e;t.isLoadingPage=!0,t.query=null==o||null==(e=o.target)?void 0:e.value,t.throttledSearch()}})),100),e.add("totalDoorkeys",m("p",{class:"DoorkeyListPage-totalDoorkeys"},o().translator.trans("fof-doorman.admin.settings.total_doorkeys",{count:this.doorkeyCount})),90),e.add("actions",m("div",{className:"DoorkeyListPage-actions"},this.actionItems().toArray()),80),e},a.actionItems=function(){var t=new(v());return t.add("createDoorkey",m(g(),{className:"Button DoorkeyListPage-createDoorkeyBtn",icon:"fas fa-door-open",onclick:function(){return o().modal.show(A)}},o().translator.trans("fof-doorman.admin.settings.create_doorkey_button")),100),t},a.columns=function(){var t=this,e=new(v());return e.add("id",{name:o().translator.trans("fof-doorman.admin.list.columns.id"),content:function(t){return t.id()}},100),e.add("key",{name:o().translator.trans("fof-doorman.admin.list.columns.key"),content:function(t){var o;return null!=(o=t.key())?o:null}},90),e.add("group",{name:o().translator.trans("fof-doorman.admin.list.columns.group"),content:function(t){var e=t.group();return e&&e.id()===L().MEMBER_ID?o().translator.trans("fof-doorman.admin.list.content.no_group"):m(P(),{group:t.group()})}},80),e.add("maxUses",{name:o().translator.trans("fof-doorman.admin.list.columns.max_uses"),content:function(t){var o;return null!=(o=t.maxUses())?o:null}},70),e.add("activates",{name:o().translator.trans("fof-doorman.admin.list.columns.activates_user"),content:function(t){return t.activates()?I()("fas fa-user-check"):I()("fas fa-times-circle")}},60),e.add("manage",{name:o().translator.trans("fof-doorman.admin.list.columns.manage"),content:function(e){return m("[",null,m(g(),{"aria-label":o().translator.trans("fof-doorman.admin.page.doorkey.heading.notify"),className:"Button Button--icon Doorkey-button",icon:"fa fa-envelope fa-fw",onclick:function(){return o().modal.show(q,{doorkey:e})}}),m(g(),{"aria-label":o().translator.trans("fof-doorman.admin.page.doorkey.heading.edit"),className:"Button Button--icon Doorkey-button",icon:"fas fa-pencil-alt",onclick:function(){return o().modal.show(H,{doorkey:e})}}),m(g(),{"aria-label":o().translator.trans("fof-doorman.admin.page.doorkey.heading.delete"),className:"Button Button--danger Button--icon",icon:"fas "+(t.loadingDelete[e.id()||""]?"fa-circle-notch fa-spin":"fa-times")+" fa-fw",onclick:function(){return t.deleteDoorkey(e)}}))}},50),e.add("uses",{name:o().translator.trans("fof-doorman.admin.list.columns.uses"),content:function(t){var e=t.maxUses(),a=t.uses(),r=e-a;return e>0&&a>=e?E().component({className:"Button--icon Doorkey-badge",icon:"fas fa-user-slash",label:o().translator.trans("fof-doorman.admin.list.content.warning")}):m("b",null,r<0?o().translator.trans("fof-doorman.admin.list.content.uses.total_uses",{totalUses:a}):o().translator.trans("fof-doorman.admin.list.content.uses.used_times",{remainingUses:r}))}},40),e.add("createdBy",{name:o().translator.trans("fof-doorman.admin.list.columns.created_by"),content:function(t){var e=t.createdBy();if(!e)return o().translator.trans("fof-doorman.admin.list.content.no_created_by");var a=o().forum.attribute("baseUrl")+"/u/"+e.slug();return m("a",{target:"_blank",href:a,title:x()(o().translator.trans("core.admin.users.grid.columns.username.profile_link_tooltip",{username:e.displayName()}))},e.displayName())}},30),e},a.loadPage=function(){var t,e=(t=l().mark((function t(e){var a=this;return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e<0&&(e=0),this.loadingPageNumber=e,this.setPageNumberInUrl(e+1),o().store.find("fof/doorkeys",{filter:{q:this.query},page:{limit:this.numPerPage,offset:e*this.numPerPage}}).then((function(t){var o;a.moreData=!(null==(o=t.payload)||null==(o=o.links)||!o.next);var r=t;delete r.payload;var n=a.getTotalPageCount();e>n?a.loadPage(n-1):(a.pageData=r,a.pageNumber=e,a.loadingPageNumber=e,a.isLoadingPage=!1),m.redraw()})).catch((function(t){console.error(t),a.pageData=[]}));case 4:case"end":return t.stop()}}),t,this)})),function(){var o=this,e=arguments;return new Promise((function(a,n){var i=t.apply(o,e);function s(t){r(i,a,n,s,l,"next",t)}function l(t){r(i,a,n,s,l,"throw",t)}s(void 0)}))});return function(t){return e.apply(this,arguments)}}(),a.nextPage=function(){this.isLoadingPage=!0,this.loadPage(this.pageNumber+1)},a.previousPage=function(){this.isLoadingPage=!0,this.loadPage(this.pageNumber-1)},a.goToPage=function(t){this.isLoadingPage=!0,this.loadPage(t-1)},a.setPageNumberInUrl=function(t){var o,e=window.location.hash.split("?",2),a=new URLSearchParams(null!=(o=null==e?void 0:e[1])?o:"");a.set("page",""+t),window.location.hash=(null==e?void 0:e[0])+"?"+a.toString()},a.deleteDoorkey=function(t){var e=this;if(confirm(x()(o().translator.trans("fof-doorman.admin.list.content.delete",{key:t.key()})))){var a=t.id();a&&(this.loadingDelete[a]=!0,m.redraw(),t.delete().finally((function(){e.loadingDelete[a]=!1,window.location.reload(),m.redraw()})))}},e}(c());const Z=flarum.core.compat["common/extenders"];var J=e.n(Z);const Q=flarum.core.compat["common/Model"];var V=e.n(Q),W=function(t){function o(){return t.apply(this,arguments)||this}i(o,t);var e=o.prototype;return e.key=function(){return V().attribute("key").call(this)},e.groupId=function(){return V().attribute("groupId").call(this)},e.group=function(){return V().hasOne("group").call(this)},e.maxUses=function(){return V().attribute("maxUses").call(this)},e.activates=function(){return V().attribute("activates").call(this)},e.uses=function(){return V().attribute("uses").call(this)},e.createdBy=function(){return V().hasOne("createdBy").call(this)},e.apiEndpoint=function(){return"/fof/doorkeys"+(this.exists?"/"+this.data.id:"")},o}(V());const X=[(new(J().Store)).add("doorkeys",W)];var tt={CreateDoorkeyModal:A,DoorkeyListPage:Y,EditDoorkeyModal:H,InviteCodeModal:q};o().initializers.add("fof-doorman",(function(){o().extensionData.for("fof-doorman").registerPage(Y)}))})(),module.exports=a})();
//# sourceMappingURL=admin.js.map